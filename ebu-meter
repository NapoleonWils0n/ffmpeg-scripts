#!/bin/sh

# ffplay ebu meter

# script usage
script_usage="$(basename "$0") -i infile.(mp4|mkv|mov|m4v|aac|m4a|wav|mp3)"

# check arguments passed to script
if [ $# -eq 2 ]; then
   {
   [ "$1" = '-i' ] && \
   [ -f "$2" ]
   } || { echo "$script_usage" && exit; }
else
   { echo "$script_usage" && exit; }
fi

# save file extension as a lowercase variable for the case statement
infile="$2"
ext="${infile##*.}"
infile_ext="$(echo "$ext" | tr '[:upper:]' '[:lower:]')"

# audio function
ebu () {
    ffplay -hide_banner \
    -f lavfi -i \
    "amovie=${infile},
    ebur128=video=1:
    meter=18:
    dualmono=true:
    target=-16:
    size=1280x720 [out0][out1]"
}

# run the audio or video function based on the file extension
case "$infile_ext" in
  mp4|mkv|mov|m4v|aac|m4a|wav|mp3) ebu "$infile";;
  *) { echo "$script_usage" && exit; };;
esac
